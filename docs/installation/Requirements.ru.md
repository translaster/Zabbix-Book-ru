# Требования

У Zabbix есть набор требований, которые должны быть выполнены на аппаратном и программном уровне.
Эти требования могут меняться со временем, а также зависят от размера вашей установки и выбранного вами программного обеспечения.
Поэтому перед тем, как начать покупать железо или устанавливать произвольную версию базы данных, загляните в документацию Zabbix и проверьте последние требования к версии, которую вы хотите установить.
Последние требования можно найти [здесь](https://www.zabbix.com/documentation/7.0/en/manual/installation/requirements). Не забудьте выбрать нужную версию *Zabbix* из списка.

Если вы не планируете запускать ничего особенного, только небольшую установку или даже тестовую, Zabbix будет работать на системе с 2 процессорами и 8 Гб оперативной памяти. Но все зависит от того, насколько большой будет ваша установка и сколько элементов вы будете отслеживать, триггеров будете создавать и как долго хотите хранить эти данные. В дни виртуализации я советую начинать с малого и добавлять больше позже.

Для настройки вы можете выбрать установку всех компонентов на одном сервере или каждого компонента на другом сервере. Для простоты использования сделайте для себя несколько заметок:

| server 		| ip 	|
|:---- 			| :----	|
| zabbix server 	|	|
| database server 	|	|
| web server		|	|



???+ tip
    Хотя zabbix использует тире «-» в своих именах, когда нам нужно установить такие пакеты, как zabbix-get или zabbix-sender, в двоичных файлах используется «_». например zabbix_sender или zabbix_server. Это, конечно, может меняться в зависимости от того, используете ли вы пакеты из оригинальных репозиториев Zabbix или нет. Просто имейте в виду, что иногда это довольно запутанно и если вы установили какой-то пакет с тире, то, возможно, двоичный файл будет с подчеркиванием.

---

## Базовая конфигурация OS

### Firewall 

Важно, чтобы на сервере Zabbix была установлена хорошо подготовленная ОС, прежде чем мы приступим к установке нашего инструмента мониторинга. Сначала нам нужно убедиться, что установлен брандмауэр. 

```# dnf install firewalld --now```

Теперь наш брандмауэр установлен, и мы готовы настроить необходимые порты. Для нашего сервера Zabbix нам нужно разрешить доступ к порту 10051/tcp - это порт, на котором наш траппер Zabbix прослушивает входящие данные. Поэтому нам нужно открыть этот порт в брандмауэре, чтобы разрешить доступ к нашему трапперу Zabbix.

```# firewall-cmd --add-service=Zabbix-server --permanent```

или если служба неизвестна

```# firewall-cmd --add-port=10051/tcp --permanent```

/// note | firewalld
«Firewalld является заменой iptables в Redhat и позволяет нам делать изменения доступными немедленно, без необходимости перезапускать службу. Возможно, ваш дистрибутив не использует [Firewalld](https://www.firewalld.org), в этом случае вам следует обратиться к документации вашей ОС.»
///


### Сервер времени

Еще одна вещь, которую нам нужно настроить, - это установка сервера времени и синхронизация нашего сервера Zabbix с сервером времени с помощью ntp-клиента. Это необходимо сделать не только для сервера Zabbix, но и для устройств, которые мы будем контролировать, поскольку время очень важно для Zabbix. Представьте, что на одном из наших хостов неправильно указан часовой пояс, и в итоге мы будем искать в Zabbix проблему, возникшую 6 часов назад, в то время как она возникла всего 2 часа назад.

```# dnf install chronyd --now```

Теперь chrony должен быть установлен, включен и запущен. Это можно проверить с помощью команды:

```# systemctl status chronyd```

/// note | dnf
«dnf - это менеджер пакетов от RedHat, вам нужно заменить dnf на ваш менеджер пакетов, например, zyper, apt, yum, ... chrony - это замена ntpd и делает эту работу лучше, будучи более быстрой и точной. Если ваша ОС не поддерживает [chrony](https://chrony-project.org/), то, возможно, понадобится ntpd.»
///


После установки Chrony нам также нужно настроить правильный часовой пояс. Сначала мы можем посмотреть с помощью 'timedatectl', чтобы узнать, как настроено наше время 

```
# timedatectl
               Local time: Thu 2023-11-16 15:09:14 UTC
           Universal time: Thu 2023-11-16 15:09:14 UTC
                 RTC time: Thu 2023-11-16 15:09:15
                Time zone: UTC (UTC, +0000)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```

Убедитесь, что служба cronyd активна, см. выше, как это сделать, если вы ее пропустили.
Мы можем выбрать правильный часовой пояс из списка, который можно посмотреть с помощью следующей команды:

```
# timedatectl list-time zones
```

В результате мы получим список со всеми доступными часовыми поясами. Выберите ближайший к вам.
```
Africa/Abidjan
Africa/Accra

...

Pacific/Tongatapu
Pacific/Wake
Pacific/Wallis
UTC
```

Теперь мы можем настроить правильный часовой пояс с помощью следующей команды:

```
timedatectl set-time zone Asia/Yekaterinburg
```

When we look again we should see our time zone properly configured.
```
# timedatectl
               Local time: Tue 2024-09-10 13:15:41 +05
           Universal time: Tue 2024-09-10 08:15:41 UTC
                 RTC time: Tue 2024-09-10 08:15:41
                Time zone: Asia/Yekaterinburg (+05, +0500)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no

```

???+ note
    "Некоторые люди предпочитают устанавливать все серверы в часовом поясе UTC, чтобы все логи сервера находились в одном часовом поясе при наличии серверов по всему миру. Zabbix поддерживает пользовательские настройки часового пояса, поэтому можно установить часовой пояс UTC на сервере, а затем добавить правильный часовой пояс в пользовательском интерфейсе, если хотите."

Мы также можем проверить, синхронизируется ли Chrony с правильными серверами, выполнив команду chronyc

```
# chronyc
chrony version 4.2
Copyright (C) 1997-2003, 2007, 2009-2021 Richard P. Curnow and others
chrony comes with ABSOLUTELY NO WARRANTY.  This is free software, and
you are welcome to redistribute it under certain conditions.  See the
GNU General Public License version 2 for details.

chronyc>
```

Теперь введём ```sources```

```
chronyc> sources
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^- 51-15-20-83.rev.poneytel>     2   9   377   354   +429us[ +429us] +/-  342ms
^- 5.255.99.180                  2  10   377   620  +7424us[+7424us] +/-   37ms
^- hachi.paina.net               2  10   377   412   +445us[ +445us] +/-   39ms
^* leontp1.office.panq.nl        1  10   377   904  +6806ns[ +171us] +/- 2336us
```

Здесь мы видим, что используем кучу ntp-серверов, которые находятся не в нашей стране, поэтому нам лучше переключиться на серверы в нашей стране или, если у нас есть сервер времени в нашей компании, то можем использовать его. Можем найти некоторые местные серверы времени здесь: [https://www.ntppool.org/](https://www.ntpool.org)

Чтобы изменить, мы должны отредактировать наш файл конфигурации «/etc/chrony.conf» и заменить существующий ntp-сервер на наш региональный 

```
# Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
pool 2.centos.pool.ntp.org iburst
```

И измените его на местный сервер:

```
# Use public servers from the pool.ntp.org project.
# Please consider joining the pool (http://www.pool.ntp.org/join.html).
pool be.pool.ntp.org iburst
```

Не забудьте, конечно, перезапустить клиент ntpd.

```
# systemctl restart chronyd
```

Когда мы посмотрим еще раз, то увидим, что теперь используем наши локальные серверы времени.

```
chronyc> sources

MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^- ntp1.unix-solutions.be        2   6    17    43   -375us[ -676us] +/-   28ms
^* ntp.devrandom.be              2   6    17    43   -579us[ -880us] +/- 2877us
^+ time.cloudflare.com           3   6    17    43   +328us[  +27us] +/- 2620us
^+ time.cloudflare.com           3   6    17    43   +218us[  -83us] +/- 2815us
```

